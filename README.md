# Парсер RSS новостей

## Описание

Проект Bootcamp Java **"Реализация парсера новостей РИА-новости через RSS канал"**

Сервис периодически подключается по ссылке к RSS каналу новостей (формат `xml`)
и заносит новые новости в базу данных

Релизован интерфейс `REST API` для чтения списка сохраненных в базе данных новостей:
* Получение списка новостей за заданный промежуток времени
* Получение N последних новостей
* Получение количества новостей за указанную дату

Для сервиса предусмотрена настройка внешнего источника новостей (ссылка на RSS канал)

### Поддерживаемая структура RSS-канала

Можно подключить любой канал, структура каждой новости которого соотсетствует шаблону:

```xml
<item>
    <title>Заголовок новости</title>
    <link>Ссылка на новость</link>
    <guid>Уникальный идентификатор новости</guid>
    <pubDate>Дата публикации новости</pubDate>
</item>
```

Очередность тегов не имеет значения 

## Компоненты

* База данных `Postgresql`
* `Liquibase` для создания структуры базы данных
* Для проверки создания структуры базы данных используется база данных `H2`
* Unit-тесты, покрывающие сервисный слой
* Приложение на `Java 17`

## Настройка

Предусмотрены настройки сервиса (файл `application.yml`)

### Настройка внешнего источника новостей

* `rss.url` - ссылка на RSS канал новостей, (по умолчанию,
  https://ria.ru/export/rss2/archive/index.xml)
* `rss.update-scheduler-time` - периодичность обновления новостей из внешнего источника
  (по умолчанию, каждый час)
* `rss.pub-date-format` - формат даты и времени новости для парсинга, используется
  формат, принятый для `java.text.SimpleDateFormat` (по умолчанию,
  `"E, d MMM yyyy HH:mm:ss Z"`, дата и время с указанием часового пояса, пример:
  `Tue, 10 Aug 2024 19:20:29 +0300`) 
* `rss.pub-date-format-lang` - язык локализации, используется для парсинга даты новости
  (по умолчанию, `en`)
* `rss.pub-date-format-country` - страна локализации, используется для парсинга даты новости
  (по умолчанию, `US`)

### Настройка базы данных

* `spring.datasource.url` - по умолчанию `jdbc:postgresql://localhost:5432/postgres`
* `spring.datasource.username` - по умолчанию `postgres`
* `spring.datasource.password` - по умолчанию `postgres`

## Установка
### Вручную
Для сборки сервиса используется `Maven`

Для запуска сервиса требуется `Postgresql`

### Docker compose
В корневой папке проекта находится файл `docker-compose.yml`, который позволяет развернуть
подготовить для работы и запустить:
* Postgresql
* Сервис

Команда для первого запуска через командную строку (выполнять в папке проекта):
```shell
docker-compose up --build
```
для последующего запуска:
```shell
docker-compose up
```
для остановки:
```shell
docker-compose down
```

## Точки входа
Актуальное описание `Swagger`:
* [http://localhost:8080/api/swagger-ui/index.html](http://localhost:8080/api/swagger-ui/index.html)

> `localhost` нужно заменить на свой хост

### API Получение списка новостей за заданный промежуток времени

Запрос `GET` к [http://localhost:8080/api/news?{beginDateTime}&{endDateTime}](http://localhost:8080/api/news)

Параметры запроса:

* `beginDateTime` - дата и время с указанием часового пояса, с которой нужно
  отобрать новости, пример: `2024-03-01 00:00:00 +0300`
* `endDateTime` - дата и время с указанием часового пояса, с которой нужно
  отобрать новости, пример: `2024-03-01 23:59:59 +0300`

Пример строки запроса:

[http://127.0.0.1:8080/api/news?beginDateTime=2024-09-10%2007%3A38%3A13%20%2B0000&endDateTime=2024-09-10%2007%3A38%3A19%20%2B0000](http://127.0.0.1:8080/api/news?beginDateTime=2024-09-10%2007%3A38%3A13%20%2B0000&endDateTime=2024-09-10%2007%3A38%3A19%20%2B0000)

Пример успешного **HTTP** ответа с кодом **200** в формате `JSON`:
```json
{
  "newsList": [
    {
      "pubDate": "2024-09-10 07:38:19 +0000",
      "title": "Шойгу назвал цель украинской атаки на Курскую область",
      "link": "https://ria.ru/20240910/shoygu-1971769113.html"
    },
    {
      "pubDate": "2024-09-10 07:38:13 +0000",
      "title": "Если бы Россию в 1990-х приняли в ЕС, ее ресурсы растащили бы, заявил Шойгу",
      "link": "https://ria.ru/20240910/evrosoyuz-1971768971.html"
    }
  ]
}
```

### API Получение N последних новостей

Запрос `GET` к [http://localhost:8080/api/news/last/{count}](http://localhost:8080/api/news/last)

Параметры запроса:

* `count` - количество отбираемых новостей

Пример строки запроса:

[http://localhost:8080/api/news/last/2](http://localhost:8080/api/news/last/2)

Пример успешного **HTTP** ответа с кодом **200** в формате `JSON`:
```json
{
  "newsList": [
    {
      "pubDate": "2024-09-10 07:38:19 +0000",
      "title": "Шойгу назвал цель украинской атаки на Курскую область",
      "link": "https://ria.ru/20240910/shoygu-1971769113.html"
    },
    {
      "pubDate": "2024-09-10 07:38:13 +0000",
      "title": "Если бы Россию в 1990-х приняли в ЕС, ее ресурсы растащили бы, заявил Шойгу",
      "link": "https://ria.ru/20240910/evrosoyuz-1971768971.html"
    }
  ]
}
```

### API Получение количества новостей за указанную дату

Запрос `GET` к [http://localhost:8080/api/news/count?{date}](http://localhost:8080/api/news/count)

Параметры запроса:

* `date` - дата на которую нужно отобрать новости в формате `yyyy-MM-dd`, пример: `2024-03-01`

Пример строки запроса:

[http://127.0.0.1:8080/api/news/count?date=2024-09-09](http://127.0.0.1:8080/api/news/count?date=2024-09-09)

Пример успешного **HTTP** ответа с кодом **200** в формате `JSON`:
```json
{
  "newsList": [
    {
      "pubDate": "2024-09-10 07:38:19 +0000",
      "title": "Шойгу назвал цель украинской атаки на Курскую область",
      "link": "https://ria.ru/20240910/shoygu-1971769113.html"
    },
    {
      "pubDate": "2024-09-10 07:38:13 +0000",
      "title": "Если бы Россию в 1990-х приняли в ЕС, ее ресурсы растащили бы, заявил Шойгу",
      "link": "https://ria.ru/20240910/evrosoyuz-1971768971.html"
    }
  ]
}
```

## Развитие

В дальнейшем развитии проекта можно:

* Добавить возможность пополнять базу новостей из различных иточников.
Для этого можно реализовать хранение настроек внешних источников в базе данных с
интерфейсом `REST API` для управления ими. Подключить систему аутентификации пользователей
для ограничения возможности работы с этими настройками